module URI
  class URI
    attr_reader scheme: String
    attr_reader host: String
    attr_reader port: Integer
    attr_reader path: String
    attr_reader query: String?
    attr_reader fragment: String?

    def initialize: (String scheme, String host, Integer port, String path, ?String? query, ?String? fragment) -> void
    def to_s: () -> String
    def default_port: () -> Integer?
    def request_uri: () -> String
  end

  def self.parse: (String uri_string) -> URI
  def self.encode_www_form_component: (untyped str) -> String
  def self.encode_www_form: (Hash[untyped, untyped] params) -> String
end

module Net
  class HTTPBadResponse < StandardError
  end

  class HTTPResponse
    attr_reader code: String?
    attr_reader message: String?
    attr_reader http_version: String?
    attr_accessor header: Hash[String, String]
    attr_accessor body: String?

    def initialize: (?String? code, ?String? message, ?String? http_version) -> void
    def self.parse: (String response_string) -> HTTPResponse
    def []: (String key) -> String?
    def []=: (String key, String value) -> String
    def get_fields: (String key) -> Array[String]
    def read_body: () { (String) -> void } -> String?
                  | () -> String?
    def success?: () -> bool
    def redirect?: () -> bool
    def client_error?: () -> bool
    def server_error?: () -> bool
    def error?: () -> bool
    def code_type: () -> singleton(HTTPResponse)?
    def to_s: () -> String
  end

  class HTTPInformation < HTTPResponse
  end

  class HTTPSuccess < HTTPResponse
  end

  class HTTPRedirection < HTTPResponse
  end

  class HTTPClientError < HTTPResponse
  end

  class HTTPServerError < HTTPResponse
  end

  class HTTPUnknownResponse < HTTPResponse
  end

  class HTTPOK < HTTPSuccess
  end

  class HTTPCreated < HTTPSuccess
  end

  class HTTPAccepted < HTTPSuccess
  end

  class HTTPNoContent < HTTPSuccess
  end

  class HTTPMovedPermanently < HTTPRedirection
  end

  class HTTPFound < HTTPRedirection
  end

  class HTTPSeeOther < HTTPRedirection
  end

  class HTTPNotModified < HTTPRedirection
  end

  class HTTPTemporaryRedirect < HTTPRedirection
  end

  class HTTPBadRequest < HTTPClientError
  end

  class HTTPUnauthorized < HTTPClientError
  end

  class HTTPForbidden < HTTPClientError
  end

  class HTTPNotFound < HTTPClientError
  end

  class HTTPMethodNotAllowed < HTTPClientError
  end

  class HTTPInternalServerError < HTTPServerError
  end

  class HTTPNotImplemented < HTTPServerError
  end

  class HTTPBadGateway < HTTPServerError
  end

  class HTTPServiceUnavailable < HTTPServerError
  end

  class HTTPGenericRequest
    attr_reader method: String
    attr_reader path: String
    attr_accessor body: String?

    def initialize: (String method, String path, ?Hash[String, String]? initheader) -> void
    def []: (String key) -> String?
    def []=: (String key, String value) -> String
    def delete: (String key) -> String?
    def each_header: () { (String, String) -> void } -> void
    def set_default_headers: (String host, Integer port) -> void
    def to_s: () -> String
    def response_body_permitted?: () -> bool
    def request_body_permitted?: () -> bool
  end

  class HTTPRequest < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Get < HTTPRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Head < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Post < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Put < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Delete < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Patch < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class Options < HTTPGenericRequest
    def initialize: (String path, ?Hash[String, String]? initheader) -> void
  end

  class HTTP
    attr_accessor address: String
    attr_accessor port: Integer
    attr_accessor open_timeout: Integer
    attr_accessor read_timeout: Integer
    attr_accessor use_ssl: bool
    attr_accessor verify_mode: Integer?
    attr_accessor ca_file: String?
    attr_accessor ca_path: String?
    attr_reader started: bool

    def initialize: (String address, ?Integer? port) -> void
    def start: () { (HTTP) -> untyped } -> HTTP
             | () -> HTTP
    def finish: () -> void
    def active?: () -> bool
    def get: (String path, ?Hash[String, String]? initheader, ?untyped dest) { (String) -> void } -> HTTPResponse
           | (String path, ?Hash[String, String]? initheader, ?untyped dest) -> HTTPResponse
    def head: (String path, ?Hash[String, String]? initheader) -> HTTPResponse
    def post: (String path, String data, ?Hash[String, String]? initheader, ?untyped dest) { (String) -> void } -> HTTPResponse
            | (String path, String data, ?Hash[String, String]? initheader, ?untyped dest) -> HTTPResponse
    def put: (String path, String data, ?Hash[String, String]? initheader, ?untyped dest) { (String) -> void } -> HTTPResponse
           | (String path, String data, ?Hash[String, String]? initheader, ?untyped dest) -> HTTPResponse
    def delete: (String path, ?Hash[String, String]? initheader, ?untyped dest) { (String) -> void } -> HTTPResponse
              | (String path, ?Hash[String, String]? initheader, ?untyped dest) -> HTTPResponse
    def request: (HTTPGenericRequest req, ?String? body) { (String) -> void } -> HTTPResponse
               | (HTTPGenericRequest req, ?String? body) -> HTTPResponse
    def self.get_content: (String uri_or_host, ?String? path, ?Integer? port) -> String?
    def self.get_response: (String uri_or_host, ?String? path, ?Integer? port) -> HTTPResponse
    def self.post_form: (String url, Hash[untyped, untyped] params) -> HTTPResponse
    def use_ssl?: () -> bool

    private

    def read_response: () -> String
  end
end
