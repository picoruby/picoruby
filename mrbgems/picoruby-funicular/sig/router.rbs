module Funicular
  type route_definition_t = { method: Symbol, path: String, component: singleton(Component), name: String?, pattern_segments: Array[String] }

  # URL helper methods are dynamically generated based on route definitions
  # Example: router.get('/users/:id', to: UserComponent, as: 'user')
  # generates: user_path(id) -> String
  module RouteHelpers
    # Dynamic methods are generated at runtime by Router#generate_url_helper
    # Method signatures depend on route parameters:
    # - No parameters: def helper_name_path: () -> String
    # - With parameters: def helper_name_path: (Integer | String | untyped) -> String
    def method_missing: (Symbol method, *untyped args) -> String
    def respond_to_missing?: (Symbol method, ?bool include_private) -> bool
  end

  class Router
    attr_reader routes: Array[route_definition_t]
    attr_reader current_component: Component?
    attr_reader current_path: String?

    def self.new: (JS::Object container) -> Router
    def get: (String path, to: singleton(Component), ?as: String?) -> void
    def post: (String path, to: singleton(Component), ?as: String?) -> void
    def put: (String path, to: singleton(Component), ?as: String?) -> void
    def patch: (String path, to: singleton(Component), ?as: String?) -> void
    def delete: (String path, to: singleton(Component), ?as: String?) -> void
    def add_route: (String path, singleton(Component) component_class, ?as: String?) -> void
    def set_default: (String path) -> void
    def start: () -> void
    def stop: () -> void
    def navigate: (String path) -> void
    def current_hash_path: () -> String
    def current_location_path: () -> String

    private def add_route_with_method: (Symbol method, String path, singleton(Component) component_class, String? name) -> void
    private def generate_url_helper: (String name, String path_pattern) -> void
    private def extract_param_names: (String path_pattern) -> Array[Symbol]
    private def handle_route_change: () -> void
    private def unmount_current_component: () -> void
    private def find_route: (String path) -> [singleton(Component) | nil, Hash[Symbol, untyped]]
  end
end
