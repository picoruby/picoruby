<!DOCTYPE html>
<html>
  <head>
    <title>PicoRuby WASM Demo</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="test.css">
  </head>
  <body>
    <div>Example using published npm package</div>
    <ul>
      <li><a href="dom.html">DOM manipulation</a></li>
      <li><a href="dom_apis.html">Advanced DOM manipulation</a></li>
      <li><a href="multitasks.html">Multi tasks</a></li>
      <li><a href="timeout.html">setTimeout and clearTimeout</a></li>
      <li><a href="prime_numbers.html">Prime numbers</a></li>
      <li><a href="websocket.html">WebSocket test</a></li>
      <li><a href="generic_callback.html">Generic callback test</a></li>
      <li><a href="longjmp/index.html">setjmp/longjmp tests</a></li>
      <li><a href="chartjs_callbacks.html">Callbacks in Chart.js test</a></li>
    </ul>
    <div>Funicular tests</div>
    <ul>
    <ul>
      <li><a href="funicular/test_vdom.html">VDOM test</a></li>
      <li><a href="funicular/test_diff_patch.html">Diff & Patch test</a></li>
      <li><a href="funicular/test_cable.html">Cable test</a></li>
      <li><a href="funicular/test_component.html">Component test</a></li>
      <li><a href="funicular/test_router.html">Router test</a></li>
      <li><a href="funicular/test_chartjs.html">Chart.js test</a></li>
      <li><a href="funicular/test_error_boundary.html">ErrorBoundary test</a></li>
      <li><a href="funicular/tic-tac-toe.html">Tic Tac Toe</a></li>
    </ul>
    <h1>PicoRuby WASM Demo</h1>
    <h2 id="container">0</h2>
    <button id="switch">Start</button>
    <div id="logo"></div>

    <script type="text/ruby">
      require 'js'
      JS.document.getElementById('switch').addEventListener('click') do |event_json|
        puts event_json # The `event_json` can be parsed by JSON.parse
        sub_task = Task.get('sub_task')
        if sub_task.status == "SUSPENDED"
          sub_task.resume
          JS.document.getElementById('switch').innerText = 'Suspend'
          lvar = :hey
          logo = JS.document.getElementById('logo')
          JS.global.fetch('favicon.ico') do |response|
            if response.status.to_i == 200
              logo.innerHTML = response.to_binary
            end
          end
        else
          sub_task.suspend
          JS.document.getElementById('switch').innerText = 'Resume'
          JS.document.getElementById('logo').innerHTML = ''
        end
      end
    </script>

    <script type="text/ruby">
      require 'js'
      task = Task.current
      task.name = 'sub_task'
      task.suspend
      container = JS.document.getElementById('container')
      i = 1
      while true
        sleep 1
        container.innerText = i.to_s
        i += 1
      end
    </script>

    <script src="init.iife.js"></script>
  </body>
</html>
